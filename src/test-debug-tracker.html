<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø¢Ù†Ù„Ø§ÛŒÙ†/Ø¢ÙÙ„Ø§ÛŒÙ†</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        direction: rtl;
        background: #f0f2f5;
      }

      .container {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .status-display {
        font-size: 32px;
        text-align: center;
        padding: 30px;
        border-radius: 12px;
        margin: 20px 0;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .online {
        background: linear-gradient(135deg, #d4edda, #c3e6cb);
        color: #155724;
        border: 3px solid #28a745;
      }

      .offline {
        background: linear-gradient(135deg, #f8d7da, #f5c6cb);
        color: #721c24;
        border: 3px solid #dc3545;
      }

      .log-container {
        max-height: 400px;
        overflow-y: auto;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
      }

      .log-entry {
        padding: 8px;
        margin: 4px 0;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 13px;
      }

      .log-online {
        background: #d4edda;
        border-left: 4px solid #28a745;
      }

      .log-offline {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
      }

      .log-info {
        background: #d1ecf1;
        border-left: 4px solid #17a2b8;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 8px;
        font-size: 14px;
        transition: background 0.2s;
      }

      button:hover {
        background: #0056b3;
      }

      .instructions {
        background: #fff3cd;
        color: #856404;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #ffeaa7;
        margin: 20px 0;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat {
        background: #e9ecef;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #495057;
      }

      .stat-label {
        font-size: 12px;
        color: #6c757d;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª ØªØ³Øª Ø³ÛŒØ³ØªÙ… ØªØ´Ø®ÛŒØµ Ø¢Ù†Ù„Ø§ÛŒÙ†/Ø¢ÙÙ„Ø§ÛŒÙ†</h1>

    <div class="instructions">
      <h3>ğŸ“‹ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´</h3>
      <p>Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø³ÛŒï¿½ï¿½ØªÙ…ØŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø²ÛŒØ± Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯:</p>
      <ul>
        <li>ğŸ” <strong>ØªØ¨ Ø¹ÙˆØ¶ Ú©Ù†ÛŒØ¯</strong> - Ø¨Ø§ÛŒØ¯ ÙÙˆØ±Ø§Ù‹ Ø¢ÙÙ„Ø§ÛŒÙ† Ø´ÙˆØ¯</li>
        <li>ğŸ”„ <strong>ØµÙØ­Ù‡ Ø±ÛŒÙ„ÙˆØ¯ Ú©Ù†ÛŒØ¯</strong> - Ø¢ÙÙ„Ø§ÛŒÙ† â†’ Ø¢Ù†Ù„Ø§ÛŒÙ†</li>
        <li>âŒ <strong>ØµÙØ­Ù‡ Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯</strong> - Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø¢ÙÙ„Ø§ÛŒÙ†</li>
        <li>ğŸ“¡ <strong>Ø§ÛŒÙ†ØªØ±Ù†Øª Ù‚Ø·Ø¹ Ú©Ù†ÛŒØ¯</strong> - Ø¨Ø§ÛŒØ¯ Ø¢ÙÙ„Ø§ÛŒÙ† Ø´ÙˆØ¯</li>
        <li>ğŸ¯ <strong>Ø±ÙˆÛŒ Ø§ÛŒÙ† ØªØ¨ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</strong> - Ø¨Ø§ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´ÙˆØ¯</li>
      </ul>
    </div>

    <div class="container">
      <h3>ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ</h3>
      <div id="statusDisplay" class="status-display offline">
        â“ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...
      </div>

      <div class="stats">
        <div class="stat">
          <div id="onlineCount" class="stat-value">0</div>
          <div class="stat-label">Ø¨Ø§Ø± Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
        </div>
        <div class="stat">
          <div id="offlineCount" class="stat-value">0</div>
          <div class="stat-label">Ø¨Ø§Ø± Ø¢ÙÙ„Ø§ÛŒÙ†</div>
        </div>
        <div class="stat">
          <div id="totalChanges" class="stat-value">0</div>
          <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØºÛŒÛŒØ±Ø§Øª</div>
        </div>
        <div class="stat">
          <div id="lastChange" class="stat-value">-</div>
          <div class="stat-label">Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±</div>
        </div>
      </div>

      <div>
        <button onclick="startTest()">ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øª</button>
        <button onclick="stopTest()">ğŸ›‘ ØªÙˆÙ‚Ù ØªØ³Øª</button>
        <button onclick="clearLogs()">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯</button>
        <button onclick="simulateActions()">âš¡ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ</button>
      </div>
    </div>

    <div class="container">
      <h3>ğŸ“‹ Ù„Ø§Ú¯ ØªØºÛŒÛŒØ±Ø§Øª</h3>
      <div id="logContainer" class="log-container">
        <div class="log-entry log-info">
          [Ø´Ø±ÙˆØ¹] Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø¢Ù†Ù„Ø§ÛŒÙ†/Ø¢ÙÙ„Ø§ÛŒÙ†
        </div>
      </div>
    </div>

    <script>
      // Test Implementation
      let isTracking = false;
      let onlineCount = 0;
      let offlineCount = 0;
      let totalChanges = 0;
      let currentStatus = null;

      // DOM elements
      const statusDisplay = document.getElementById("statusDisplay");
      const logContainer = document.getElementById("logContainer");

      function startTest() {
        if (isTracking) return;

        log("ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø³ÛŒØ³ØªÙ…", "info");
        isTracking = true;

        // Setup event listeners
        setupEventListeners();

        // Initial state
        updateStatus(true, "Ø´Ø±ÙˆØ¹ ØªØ³Øª");
      }

      function stopTest() {
        if (!isTracking) return;

        log("ğŸ›‘ ØªÙˆÙ‚Ù ØªØ³Øª Ø³ÛŒØ³ØªÙ…", "info");
        updateStatus(false, "ØªÙˆÙ‚Ù ØªØ³Øª");
        isTracking = false;
      }

      function clearLogs() {
        logContainer.innerHTML =
          '<div class="log-entry log-info">[Ù¾Ø§Ú© Ø´Ø¯] Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯</div>';
      }

      function simulateActions() {
        log("âš¡ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ù…Ø®ØªÙ„Ù", "info");

        // Simulate tab hidden
        setTimeout(() => {
          updateStatus(false, "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ: ØªØ¨ Ù…Ø®ÙÛŒ");
        }, 1000);

        // Simulate tab visible
        setTimeout(() => {
          updateStatus(true, "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ: ØªØ¨ Ù†Ù…Ø§ÛŒØ§Ù†");
        }, 3000);

        // Simulate offline
        setTimeout(() => {
          updateStatus(false, "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ: Ù‚Ø·Ø¹ Ø§ÛŒÙ†ØªØ±Ù†Øª");
        }, 5000);

        // Simulate online
        setTimeout(() => {
          updateStatus(true, "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ: ÙˆØµÙ„ Ø§ÛŒÙ†ØªØ±Ù†Øª");
        }, 7000);
      }

      function setupEventListeners() {
        // Visibility change
        document.addEventListener("visibilitychange", () => {
          if (!isTracking) return;
          const isVisible = !document.hidden;
          updateStatus(isVisible, isVisible ? "ØªØ¨ Ù†Ù…Ø§ÛŒØ§Ù† Ø´Ø¯" : "ØªØ¨ Ù…Ø®ÙÛŒ Ø´Ø¯");
        });

        // Window focus/blur
        window.addEventListener("focus", () => {
          if (!isTracking) return;
          updateStatus(true, "ÙÙˆÚ©ÙˆØ³ Ø±ÙˆÛŒ Ù¾Ù†Ø¬Ø±Ù‡");
        });

        window.addEventListener("blur", () => {
          if (!isTracking) return;
          updateStatus(false, "Ø®Ø±ÙˆØ¬ ÙÙˆÚ©ÙˆØ³ Ø§Ø² Ù¾Ù†Ø¬Ø±Ù‡");
        });

        // Page unload
        window.addEventListener("beforeunload", () => {
          if (!isTracking) return;
          updateStatus(false, "Ø¯Ø± Ø­Ø§Ù„ Ø®Ø±ÙˆØ¬ Ø§Ø² ØµÙØ­Ù‡");
        });

        // Network status
        window.addEventListener("online", () => {
          if (!isTracking) return;
          updateStatus(true, "Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¨Ø±Ù‚Ø±Ø§Ø±");
        });

        window.addEventListener("offline", () => {
          if (!isTracking) return;
          updateStatus(false, "Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª");
        });

        log("âœ… Event listeners Ù…ØªØµÙ„ Ø´Ø¯Ù†Ø¯", "info");
      }

      function updateStatus(isOnline, reason) {
        const timestamp = new Date().toLocaleTimeString("fa-IR");
        const statusText = isOnline ? "Ø¢Ù†Ù„Ø§ÛŒÙ†" : "Ø¢ÙÙ„Ø§ÛŒÙ†";
        const statusEmoji = isOnline ? "ğŸŸ¢" : "ğŸ”´";

        // Update display
        statusDisplay.textContent = `${statusEmoji} ${statusText}`;
        statusDisplay.className = `status-display ${
          isOnline ? "online" : "offline"
        }`;

        // Update stats
        if (currentStatus !== isOnline) {
          totalChanges++;
          currentStatus = isOnline;

          if (isOnline) {
            onlineCount++;
          } else {
            offlineCount++;
          }

          // Update stats display
          document.getElementById("onlineCount").textContent =
            onlineCount.toString();
          document.getElementById("offlineCount").textContent =
            offlineCount.toString();
          document.getElementById("totalChanges").textContent =
            totalChanges.toString();
          document.getElementById("lastChange").textContent = timestamp;
        }

        // Log the change
        log(
          `${statusEmoji} ${statusText} - ${reason}`,
          isOnline ? "online" : "offline",
        );

        // Simulate Telegram API call
        simulateTelegramAPI(isOnline, reason, timestamp);
      }

      function simulateTelegramAPI(isOnline, reason, timestamp) {
        // Simulate API call to Telegram
        const apiData = {
          isOnline,
          reason,
          timestamp,
          statusText: isOnline ? "Ø¢Ù†Ù„Ø§ÛŒÙ†" : "Ø¢ÙÙ„Ø§ÛŒÙ†",
          statusEmoji: isOnline ? "ğŸŸ¢" : "ğŸ”´",
        };

        console.log("ğŸ“¤ [SIMULATED API CALL] Sending to Telegram:", apiData);

        // Simulate API response
        setTimeout(() => {
          console.log("âœ… [SIMULATED API RESPONSE] Success");
          log(
            `ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…: ${apiData.statusEmoji} ${apiData.statusText}`,
            "info",
          );
        }, 200);
      }

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString("fa-IR");
        const logEntry = document.createElement("div");
        logEntry.className = `log-entry log-${type}`;
        logEntry.textContent = `[${timestamp}] ${message}`;

        logContainer.appendChild(logEntry);
        logContainer.scrollTop = logContainer.scrollHeight;

        // Keep only last 50 logs
        if (logContainer.children.length > 50) {
          logContainer.removeChild(logContainer.children[0]);
        }
      }

      // Auto-start when page loads
      window.addEventListener("load", () => {
        startTest();
      });
    </script>
  </body>
</html>
